{% extends 'base.html' %}
{% block title %}New {% endblock %}
{% block header %}
{% endblock %}

{% block content %}
<form class="form" method="post">
    <div class="row">
        <div class="col-lg-12">
            <section class="panel">
                <header class="panel-heading">
                    <h3><i class="fa fa-file-text-o"></i> Reservation</h3>
                </header>

                <div class="panel-body">
                    <form class="form-horizontal " method="get">
                        <div class="form-group">
                            <label class="control-label col-lg-2" for="inputSuccess">Room</label>
                            <div class="col-lg-10 radio">
                                {{ form.room_id() }}


                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-lg-2">Date</label>
                            <div class="col-lg-10">
                                {{ form.booked_date(placeholder="") }}
                            </div>

                        </div>

                        <div class="form-group">
                            <label class="control-label col-lg-2">Time</label>
                            <div class="col-lg-10">
                                <!--input type="time" class="round-input" style="border-width:2px"><input type="time" class="round-input"-->
                                {{ form.time_start(placeholder="") }}
                                -
                                {{ form.time_end(placeholder="") }}

                            </div>
                        </div>
                        <div class="form-group" onblur="hideList()">
                            <label class="control-label col-lg-2" for="inputSuccess">Participants:</label>
                            <div class="col-lg-10" width=50 onfocus="showList()" onblur="hideList()"tabindex="0">
                                <input type="text" id="myInput" onfocus="searchName();showList();" 
                                    placeholder="Search for names..">
                                <div id="party_checklist" style="display:none">
                                    {{ form.participants(onclick="checkParticipant()") }}
                                </div>
                            </div>
                        </div>
                        <!--Show checked participants, defaulted display: none, revealed when checked-->
                        <div id="participant_list_txt">
                            <ul id="party_list">
                                {% for participant in participants %}
                                <li id="li2" style="display:none">{{ participant.name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                </div>
                <div class="form-group">
                    <div class="col-lg-10">
                        <input type="submit" class="btn btn-success" value="Submit">
                        <input type="reset" class="btn btn-danger" value="Clear Form">
                        <button type="button" class="btn" onsubmit="showSchedule()">Schedule</button>
                        <div>
                            Schedule Here!
                            <table id="schedule" style="display: none;">
                                <tr>
                                    {% for i in range(1, no_of_rooms + 1) %}
                                    <td>{{ "Room " ~i}}</td>
                                    {% endfor %}
                                </tr>
                                {% for i in range(hours[0], hours[1]+1) %}
                                <tr>
                                    {% for j in range(1, no_of_rooms + 1) %}
                                    <td>{{j}}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    {{ form.csrf_token }}

</form>
{% endblock %}

{% block script %}
<script>
    function showList() {
        var div = document.getElementById('party_checklist');
        div.style.display = "";
    }
    function hideList() {
        var div = document.getElementById('party_checklist');
        div.style.display = "none";
    }

    function searchName() {
        // Declare variables
        var input, filter, ul, li, i, txtValue;
        input = document.getElementById('myInput');
        filter = input.value.toUpperCase();
        ul = document.getElementById("participants");
        li = ul.getElementsByTagName('li');
        // Loop through all list items, and hide those who don't match the search query
        for (i = 0; i < li.length; i++) {

            if (li[i].getElementsByTagName('input')[0].checked) {
                console.log(li[i].textContent);
            }
            txtValue = li[i].textContent || li[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                li[i].style.display = "";
            } else {
                li[i].style.display = "none";
            }
        }
    }

    function checkParticipant() {
        var ul, li, list, ul2, li2, i;
        ul = document.getElementById("participants");
        li = ul.getElementsByTagName("li");

        ul2 = document.getElementById("party_list");
        li2 = ul2.getElementsByTagName("li");

        list = document.getElementById("participant_list_txt");
        for (i = 0; i < li2.length; i++) {

            if (li[i].getElementsByTagName('input')[0].checked) {
                console.log('checked');
                li2[i].style.display = "";
            }
            else {
                console.log('unchecked')
                li2[i].style.display = "none";
            }
        }
    }

    function showSchedule() {
        var x = document.getElementById("schedule");
        if (x.style.display == "none") {
            x.style.display = "";
        } else {
            x.style.display = "none";
        }
        var date = document.getElementById("booked_date");
        console.log(date.value);
    }
</script>
{% endblock %}